<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GROVE | Cut Slip</title>

<style>
:root{
  --bg:#070707;
  --line:rgba(255,255,255,.12);
  --text:#f5f5f5;
  --muted:rgba(255,255,255,.65);
  --red:#ef2a1f;
  --radius:22px;
  --shadow:0 20px 60px rgba(0,0,0,.55);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  padding:22px;
  overflow-x:hidden;
}
.bgGlow{
  position:fixed; inset:-40%;
  background:
    radial-gradient(900px 500px at 18% 18%, rgba(239,42,31,.14), transparent 60%),
    radial-gradient(700px 450px at 85% 35%, rgba(255,255,255,.05), transparent 60%);
  filter: blur(14px);
  animation: float 12s ease-in-out infinite alternate;
  pointer-events:none;
  z-index:-3;
}
@keyframes float{ from{transform:translate(-1%,-1%)} to{transform:translate(1%,1%)} }

.wrap{max-width:900px;margin:0 auto;position:relative}

/* watermark zoom */
.wm{
  position:absolute;
  left:50%;
  top:56%;
  width:min(720px,80%);
  transform: translate(-50%,-50%);
  pointer-events:none;
  z-index:-1;
  animation: zoomBreath 16s ease-in-out infinite;
}
.wm img{
  width:100%;
  opacity:.10;
  filter: grayscale(100%) contrast(115%);
}
.wmGlow{
  position:absolute;
  inset:-20%;
  background: radial-gradient(circle at center, rgba(255,255,255,.25), rgba(255,255,255,0) 65%);
  filter: blur(14px);
  z-index:-2;
}
@keyframes zoomBreath{
  0%{transform:translate(-50%,-50%) scale(1)}
  50%{transform:translate(-50%,-50%) scale(1.05)}
  100%{transform:translate(-50%,-50%) scale(1)}
}

.card{
  border:1px solid var(--line);
  border-radius:var(--radius);
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  box-shadow:var(--shadow);
  overflow:hidden;
}
.top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:18px 20px;
  border-bottom:1px solid var(--line);
  background:rgba(0,0,0,.22);
}
.logoPlate{
  background:#fff;
  padding:12px 16px;
  border-radius:18px;
  box-shadow:0 12px 30px rgba(0,0,0,.35);
  display:flex;
  align-items:center;
  gap:12px;
}
.logoPlate img{height:58px}
.title{
  display:flex;
  flex-direction:column;
  gap:3px;
}
.title h1{margin:0;font-size:18px}
.title div{color:var(--muted);font-size:12px}

.actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
.btn{
  border:1px solid var(--line);
  background:rgba(255,255,255,.04);
  color:var(--text);
  font-weight:900;
  padding:10px 12px;
  border-radius:999px;
  cursor:pointer;
}
.btn.primary{
  border:none;
  background:linear-gradient(180deg,#ff3b30,var(--red));
}

.body{padding:18px 20px 22px; display:grid; gap:14px}

.bigCut{
  border:1px solid rgba(239,42,31,.35);
  background: rgba(239,42,31,.08);
  border-radius:20px;
  padding:16px;
}
.bigCut .k{font-size:12px;font-weight:900;color:rgba(255,255,255,.72)}
.bigCut .v{margin-top:6px;font-size:44px;font-weight:1000;letter-spacing:.2px}
.bigCut .sub{margin-top:8px;color:rgba(255,255,255,.60);font-size:12px}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
@media(max-width:760px){ .grid{grid-template-columns:1fr} .wm{display:none} }

.box{
  border:1px solid var(--line);
  background:rgba(0,0,0,.20);
  border-radius:18px;
  padding:14px;
}
.box .k{font-size:12px;font-weight:900;color:rgba(255,255,255,.70)}
.box .v{margin-top:6px;font-size:16px;font-weight:900}

.note{
  border:1px solid var(--line);
  background:rgba(0,0,0,.20);
  border-radius:18px;
  padding:14px;
}
.note .k{font-size:12px;font-weight:900;color:rgba(255,255,255,.70)}
.note .v{margin-top:6px;font-size:14px;color:rgba(255,255,255,.85);line-height:1.5}

.footer{
  border-top:1px solid var(--line);
  padding:14px 20px;
  font-size:12px;
  color:rgba(255,255,255,.45);
  display:flex;
  justify-content:space-between;
  background:rgba(0,0,0,.18);
}
.bad{
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.03);
  border-radius:18px;
  padding:14px;
  color:rgba(255,255,255,.75);
  line-height:1.5;
}

/* print clean */
@media print{
  body{background:#fff;color:#000;padding:0}
  .bgGlow,.wm,.actions{display:none !important}
  .card{box-shadow:none;border:1px solid #000}
  .top{background:#fff;border-bottom:1px solid #000}
  .title div, .footer{color:#111}
  .bigCut{border:1px solid #000;background:#fff}
  .bigCut .k,.bigCut .sub{color:#111}
  .box,.note{border:1px solid #000;background:#fff}
  .box .k,.note .k{color:#111}
  .footer{background:#fff;border-top:1px solid #000}
}
</style>
</head>

<body>
<div class="bgGlow"></div>

<div class="wrap">
  <div class="wm" aria-hidden="true">
    <div class="wmGlow"></div>
    <img src="grove-logo.png" alt="">
  </div>

  <div class="card">
    <div class="top">
      <div class="logoPlate">
        <img src="grove-logo.png" alt="GROVE">
        <div class="title">
          <h1>Cut Slip</h1>
          <div id="stamp">—</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" onclick="goBack()">← Back</button>
        <button class="btn primary" onclick="window.print()">Print</button>
      </div>
    </div>

    <div class="body" id="content">
      <div class="bad">Loading cut details…</div>
    </div>

    <div class="footer">
      <div>© GROVE Services Ltd.</div>
      <div>Internal use only</div>
    </div>
  </div>
</div>

<script>
function goBack(){
  // go back to calculator if possible, else default
  if (document.referrer) history.back();
  else window.location.href = "calculator.html";
}

function decodeBase64Unicode(str){
  // Handles UTF-8 safely
  try{
    return decodeURIComponent(Array.prototype.map.call(atob(str), c => '%' + ('00'+c.charCodeAt(0).toString(16)).slice(-2)).join(''));
  }catch(e){
    return null;
  }
}

function getParam(name){
  const url = new URL(window.location.href);
  return url.searchParams.get(name);
}

function safe(v){ return (v === undefined || v === null || v === "") ? "—" : String(v); }

(function init(){
  const d = getParam("d");
  const stamp = document.getElementById("stamp");
  const content = document.getElementById("content");

  if(!d){
    content.innerHTML = `
      <div class="bad">
        <b>No slip data found.</b><br><br>
        This page is opened from a QR code on a cut slip.
      </div>`;
    stamp.textContent = "No data";
    return;
  }

  const json = decodeBase64Unicode(d);
  if(!json){
    content.innerHTML = `
      <div class="bad">
        <b>Slip data could not be read.</b><br><br>
        Please reprint the slip and scan again.
      </div>`;
    stamp.textContent = "Invalid data";
    return;
  }

  let slip;
  try{ slip = JSON.parse(json); }
  catch(e){
    content.innerHTML = `
      <div class="bad">
        <b>Slip data format error.</b><br><br>
        Please reprint the slip and scan again.
      </div>`;
    stamp.textContent = "Format error";
    return;
  }

  stamp.textContent = safe(slip.timePretty || slip.timeKey || "");

  content.innerHTML = `
    <div class="bigCut">
      <div class="k">CUT LENGTH</div>
      <div class="v">${safe(slip.cut)} <span style="font-size:18px;font-weight:1000;opacity:.85">mm</span></div>
      <div class="sub">Cut Length = CTC − (A + B)</div>
    </div>

    <div class="grid">
      <div class="box">
        <div class="k">PIPE SIZE</div>
        <div class="v">${safe(slip.size)}</div>
      </div>
      <div class="box">
        <div class="k">ID / OD</div>
        <div class="v">${safe(slip.id)} / ${safe(slip.od)} mm</div>
      </div>

      <div class="box">
        <div class="k">END A</div>
        <div class="v">${safe(slip.endALabel)} (${safe(slip.offA)}mm)</div>
      </div>
      <div class="box">
        <div class="k">END B</div>
        <div class="v">${safe(slip.endBLabel)} (${safe(slip.offB)}mm)</div>
      </div>

      <div class="box">
        <div class="k">CTC</div>
        <div class="v">${safe(slip.ctc)} mm</div>
      </div>
      <div class="box">
        <div class="k">OFFSETS</div>
        <div class="v">A ${safe(slip.offA)} + B ${safe(slip.offB)} mm</div>
      </div>
    </div>

    <div class="note">
      <div class="k">NOTES</div>
      <div class="v" style="font-weight:800">${(slip.notes && slip.notes.trim()) ? slip.notes.trim() : "—"}</div>
    </div>
  `;
})();
</script>
</body>
</html>
