<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GROVE | Cut Slip</title>

<style>
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:#070707;
  color:#fff;
  padding:20px;
}
.wrap{max-width:820px;margin:0 auto}
.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:14px;
}
.logo{
  background:#fff;
  padding:10px 14px;
  border-radius:14px;
}
.logo img{height:44px}
.actions{display:flex;gap:10px}
.btn{
  padding:10px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.05);
  color:#fff;
  font-weight:800;
  cursor:pointer;
}
.btn.primary{
  background:#ef2a1f;
  border:none;
}
.card{
  border:1px solid rgba(255,255,255,.18);
  border-radius:22px;
  background:rgba(255,255,255,.04);
  padding:18px;
}
.big{
  font-size:42px;
  font-weight:1000;
  margin-bottom:10px;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.kv{
  border:1px solid rgba(255,255,255,.18);
  border-radius:14px;
  padding:10px;
}
.k{font-size:11px;opacity:.7;font-weight:900}
.v{margin-top:6px;font-weight:900}
.note{
  margin-top:12px;
  border:1px dashed rgba(255,255,255,.25);
  padding:10px;
  border-radius:14px;
}
.toast{
  margin-top:12px;
  font-size:13px;
  font-weight:800;
  color:#9cff9c;
  display:none;
}

/* PRINT */
@media print{
  body{background:#fff;color:#000;padding:0}
  .top,.actions,.toast{display:none}
  .card{border:1px solid #000}
}
</style>
</head>

<body>
<div class="wrap">

  <div class="top">
    <div class="logo">
      <img src="grove-logo.png" alt="GROVE">
    </div>
    <div class="actions">
      <button class="btn" onclick="goBack()">← Back</button>
      <button class="btn" onclick="copySlip()">Copy</button>
      <button class="btn primary" onclick="printSlip()">Print</button>
    </div>
  </div>

  <div class="card" id="slip">
    <div class="big" id="cut">—</div>

    <div class="grid">
      <div class="kv"><div class="k">PIPE SIZE</div><div class="v" id="size">—</div></div>
      <div class="kv"><div class="k">ID / OD</div><div class="v" id="idod">—</div></div>
      <div class="kv"><div class="k">END A</div><div class="v" id="endA">—</div></div>
      <div class="kv"><div class="k">END B</div><div class="v" id="endB">—</div></div>
      <div class="kv"><div class="k">CTC (mm)</div><div class="v" id="ctc">—</div></div>
      <div class="kv"><div class="k">OFFSETS</div><div class="v" id="offs">—</div></div>
    </div>

    <div class="note">
      <div class="k">NOTES</div>
      <div class="v" id="notes">—</div>
    </div>
  </div>

  <div class="toast" id="toast">Copied to clipboard ✅</div>

</div>

<script>
function decode(){
  const p=new URLSearchParams(location.search).get("d");
  if(!p) return null;
  try{
    return JSON.parse(decodeURIComponent(escape(atob(decodeURIComponent(p)))));
  }catch(e){ return null; }
}

function set(id,v){
  document.getElementById(id).textContent = v ?? "—";
}

function goBack(){
  history.length>1 ? history.back() : location.href="calculator.html";
}

/* ✅ SAFARI SAFE COPY */
function copySlip(){
  const text = `
GROVE CUT SLIP
CUT: ${document.getElementById("cut").textContent}
SIZE: ${document.getElementById("size").textContent}
ID/OD: ${document.getElementById("idod").textContent}
END A: ${document.getElementById("endA").textContent}
END B: ${document.getElementById("endB").textContent}
CTC: ${document.getElementById("ctc").textContent}
OFFSETS: ${document.getElementById("offs").textContent}
NOTES: ${document.getElementById("notes").textContent}
LINK: ${location.href}
`;

  const ta=document.createElement("textarea");
  ta.value=text;
  document.body.appendChild(ta);
  ta.select();
  document.execCommand("copy");
  document.body.removeChild(ta);

  const t=document.getElementById("toast");
  t.style.display="block";
  setTimeout(()=>t.style.display="none",1500);
}

/* ✅ SAFARI SAFE PRINT */
function printSlip(){
  window.focus();
  window.print();
}

/* INIT */
(function(){
  const d=decode();
  if(!d){ set("cut","INVALID SLIP"); return; }

  set("cut", `${d.cut} mm`);
  set("size", d.s);
  set("idod", `${d.i} / ${d.o} mm`);
  set("endA", `${d.a} (${d.oa}mm)`);
  set("endB", `${d.b} (${d.ob}mm)`);
  set("ctc", d.c);
  set("offs", `A ${d.oa} + B ${d.ob}`);
  set("notes", d.n || "—");
})();
</script>

</body>
</html>
